<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fazrr - Donasi QRIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-900 text-white">
    <div class="w-full max-w-md p-6 bg-gray-800 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-center mb-4">Donasi QRIS</h2>
        <p class="text-center text-gray-400 mb-4">Scan QR untuk berdonasi ❤️</p>

        <label class="block mb-2">Nominal Donasi:</label>
        <input type="number" id="nominalInput" class="w-full p-2 text-black rounded" placeholder="Masukkan nominal">

        <button id="generateQR" class="w-full mt-4 bg-blue-500 hover:bg-blue-600 p-2 rounded">
            Buat QR Code
        </button>

        <div class="mt-4 text-center">
            <img id="qrImage" class="mx-auto hidden" alt="QR Code">
        </div>
    </div>

    <script>
        function computeCRC16(qrData) {
            let crc = 0xFFFF;
            for (let i = 0; i < qrData.length; i++) {
                crc ^= qrData.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    if ((crc & 0x8000) !== 0) {
                        crc = (crc << 1) ^ 0x1021;
                    } else {
                        crc = crc << 1;
                    }
                }
            }
            return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4, '0');
        }

        function generateQRIS() {
            let nominal = document.getElementById("nominalInput").value.trim();

            if (!nominal || isNaN(nominal) || parseInt(nominal) < 1) {
                Swal.fire({
                    icon: 'error',
                    title: 'Nominal Tidak Valid',
                    text: 'Masukkan nominal dengan benar!',
                    confirmButtonColor: '#3B82F6'
                });
                return;
            }

            // **Format QRIS yang lebih universal**
            let qrisTemplate = [
                "000201", 
                "010212", 
                "26670016COM.NOBUBANK.WWW", 
                "01189360050300000879", 
                "52040000", 
                "5303360", 
                "5802ID", 
                "5907Donatur", 
                "6003IDN", 
                `54${nominal.length.toString().padStart(2, '0')}${nominal}`, 
                "6304" // CRC16 akan dihitung di sini
            ].join('');

            let crc = computeCRC16(qrisTemplate);
            let finalQRIS = qrisTemplate + crc;

            const qr = qrcode(0, 'M');
            qr.addData(finalQRIS);
            qr.make();

            let qrImage = document.getElementById("qrImage");
            qrImage.src = qr.createDataURL(10);
            qrImage.classList.remove("hidden");

            Swal.fire({
                title: 'Scan QRIS',
                html: `<img src="${qr.createDataURL(10)}" alt="QRIS Code" class="w-full mx-auto">`,
                confirmButtonText: 'Tutup',
                confirmButtonColor: '#3B82F6',
                background: '#1E293B',
                color: '#ffffff'
            });
        }

        document.getElementById("generateQR").addEventListener("click", generateQRIS);
    </script>
</body>
</html>
